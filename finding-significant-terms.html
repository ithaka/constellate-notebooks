
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Finding Significant Words Using TF/IDF &#8212; Teaching Text Analysis with Constellate</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/constellate-beta.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Teaching Text Analysis with Constellate</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="book/intro.html">
   About
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  The Course
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="book/schedule.html">
   Course Schedule
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="book/syllabus.html">
   Course Syllabus
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Open Educational Directory
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="book/all-notebooks.html">
   Open Notebook Lessons Directory
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="book/add-my-lesson.html">
   Add your lesson or class
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://constellate.org/docs/how-to-create-a-course-website">
   Create Course from this template
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference external" href="https://constellate.org">
   Constellate Platform
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://constellate.org/docs">
   Constellate Documentation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://constellate.org/docs/key-terms">
   Text Analysis Glossary
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://jupyterbook.org/intro.html">
   Jupyter Book Documentation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="book/keep-learning.html">
   More ways to keep learning
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/finding-significant-terms.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/ithaka/tdm-notebooks"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/ithaka/tdm-notebooks/issues/new?title=Issue%20on%20page%20%2Ffinding-significant-terms.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/ithaka/tdm-notebooks/edit/master/finding-significant-terms.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="http://backend.constellate.org/binder/launch/v2/gh/ithaka/tdm-notebooks/master?urlpath=tree/finding-significant-terms.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-is-term-frequency-inverse-document-frequency-tf-idf">
   What is “Term Frequency- Inverse Document Frequency” (TF-IDF)?
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tf-idf-calculation-in-plain-english">
     TF-IDF Calculation in Plain English
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#computing-tf-idf-with-your-dataset">
   Computing TF-IDF with your Dataset
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#apply-pre-processing-filters-if-available">
   Apply Pre-Processing Filters (if available)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#define-a-unigram-processing-function">
   Define a Unigram Processing Function
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#collect-lists-of-document-ids-titles-and-unigrams">
   Collect lists of Document IDs, Titles, and Unigrams
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-gensim-to-compute-term-frequency-inverse-document-frequency">
   Using Gensim to Compute “Term Frequency- Inverse Document Frequency”
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#creating-a-gensim-dictionary">
     Creating a Gensim Dictionary
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#creating-a-bag-of-words-corpus">
   Creating a Bag of Words Corpus
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-the-tfidfmodel">
   Create the
   <code class="docutils literal notranslate">
    <span class="pre">
     TfidfModel
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#find-top-terms-in-a-single-document">
   Find Top Terms in a Single Document
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#display-most-significant-term-for-each-document">
   Display Most Significant Term for each Document
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ranking-documents-by-tf-idf-score-for-a-search-word">
   Ranking documents by TF-IDF Score for a Search Word
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <p><img alt="https://ithaka-labs.s3.amazonaws.com/static-files/images/tdm/tdmdocs/CC_BY.png" class="align-left" src="https://ithaka-labs.s3.amazonaws.com/static-files/images/tdm/tdmdocs/CC_BY.png" /><br /></p>
<p>Created by <a class="reference external" href="http://nkelber.com">Nathan Kelber</a> and Ted Lawless for <a class="reference external" href="https://labs.jstor.org/">JSTOR Labs</a> under <a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons CC BY License</a><br />
For questions/comments/improvements, email <a class="reference external" href="mailto:nathan&#46;kelber&#37;&#52;&#48;ithaka&#46;org">nathan<span>&#46;</span>kelber<span>&#64;</span>ithaka<span>&#46;</span>org</a>.<br /></p>
<hr class="docutils" />
<div class="section" id="finding-significant-words-using-tf-idf">
<h1>Finding Significant Words Using TF/IDF<a class="headerlink" href="#finding-significant-words-using-tf-idf" title="Permalink to this headline">¶</a></h1>
<p><strong>Description:</strong>
This <a class="reference external" href="https://docs.constellate.org/key-terms/#jupyter-notebook">notebook</a> shows how to discover significant words. The method for finding significant terms is <a class="reference external" href="https://docs.constellate.org/key-terms/#tf-idf">tf-idf</a>.  The following processes are described:</p>
<ul class="simple">
<li><p>An educational overview of TF-IDF, including how it is calculated</p></li>
<li><p>Using the <code class="docutils literal notranslate"><span class="pre">constellate</span></code> client to retrieve a dataset</p></li>
<li><p>Filtering based on a pre-processed ID list</p></li>
<li><p>Cleaning the tokens in the dataset</p></li>
<li><p>Creating a <a class="reference external" href="https://docs.constellate.org/key-terms/#gensim-dictionary">gensim dictionary</a></p></li>
<li><p>Creating a <a class="reference external" href="https://docs.constellate.org/key-terms/#gensim">gensim</a> <a class="reference external" href="https://docs.constellate.org/key-terms/#bag-of-words">bag of words</a> <a class="reference external" href="https://docs.constellate.org/key-terms/#corpus">corpus</a></p></li>
<li><p>Computing the most significant words in your <a class="reference external" href="https://docs.constellate.org/key-terms/#corpus">corpus</a> using <a class="reference external" href="https://docs.constellate.org/key-terms/#gensim">gensim</a> implementation of <a class="reference external" href="https://docs.constellate.org/key-terms/#tf-idf">TF-IDF</a></p></li>
</ul>
<p><strong>Use Case:</strong> For Learners (Detailed explanation, not ideal for researchers)</p>
<p><a class="reference internal" href="finding-significant-terms-for-research.html"><span class="doc std std-doc">Take me to the <strong>Research Version</strong> of this notebook -&gt;</span></a></p>
<p><strong>Difficulty:</strong> Intermediate</p>
<p><strong>Completion time:</strong> 60 minutes</p>
<p><strong>Knowledge Required:</strong></p>
<ul class="simple">
<li><p>Python Basics Series (<a class="reference internal" href="python-basics-1.html"><span class="doc std std-doc">Start Python Basics I</span></a>)</p></li>
</ul>
<p><strong>Knowledge Recommended:</strong></p>
<ul class="simple">
<li><p><span class="xref myst">Exploring Metadata</span></p></li>
<li><p><a class="reference internal" href="working-with-dataset-files.html"><span class="doc std std-doc">Working with Dataset Files</span></a></p></li>
<li><p><a class="reference internal" href="pandas-1.html"><span class="doc std std-doc">Pandas I</span></a></p></li>
<li><p>A familiarity with <a class="reference external" href="https://docs.constellate.org/key-terms/#gensim">gensim</a> is helpful but not required.</p></li>
</ul>
<p><strong>Data Format:</strong> <a class="reference external" href="https://docs.constellate.org/key-terms/#jsonl">JSON Lines (.jsonl)</a></p>
<p><strong>Libraries Used:</strong></p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.constellate.org/key-terms/#tdm-client">constellate</a> client to collect, unzip, and read our dataset</p></li>
<li><p><a class="reference external" href="https://constellate.org/docs/key-terms/#pandas">pandas</a> to load a preprocessing list</p></li>
<li><p><a class="reference external" href="https://docs.constellate.org/key-terms/#gensim">gensim</a> to help compute the <a class="reference external" href="https://docs.constellate.org/key-terms/#tf-idf">tf-idf</a> calculations</p></li>
<li><p><a class="reference external" href="https://docs.constellate.org/key-terms/#nltk">NLTK</a> to create a stopwords list (if no list is supplied)</p></li>
</ul>
<p><strong>Research Pipeline:</strong></p>
<ol class="simple">
<li><p>Build a dataset</p></li>
<li><p>Create a “Pre-Processing CSV” with <a class="reference internal" href="exploring-metadata.html"><span class="doc std std-doc">Exploring Metadata</span></a> (Optional)</p></li>
<li><p>Complete the TF-IDF analysis with this notebook</p></li>
</ol>
<hr class="docutils" />
<div class="section" id="what-is-term-frequency-inverse-document-frequency-tf-idf">
<h2>What is “Term Frequency- Inverse Document Frequency” (TF-IDF)?<a class="headerlink" href="#what-is-term-frequency-inverse-document-frequency-tf-idf" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://docs.constellate.org/key-terms/#tf-idf">TF-IDF</a> is used in <a class="reference external" href="https://docs.constellate.org/key-terms/#machine-learning">machine learning</a> and <a class="reference external" href="https://docs.constellate.org/key-terms//#nlp">natural language processing</a> for measuring the significance of particular terms for a given document. It consists of two parts that are multiplied together:</p>
<ol class="simple">
<li><p>Term Frequency- A measure of how many times a given word appears in a document</p></li>
<li><p>Inverse Document Frequency- A measure of how many times the same word occurs in other documents within the corpus</p></li>
</ol>
<p><strong>Before starting this lesson,</strong> we recommend reading the <a class="reference external" href="https://ghost.constellate.org/what-is-tf-idf/">explanation of TF/IDF</a> in the Constellate documentation.</p>
<div class="section" id="tf-idf-calculation-in-plain-english">
<h3>TF-IDF Calculation in Plain English<a class="headerlink" href="#tf-idf-calculation-in-plain-english" title="Permalink to this headline">¶</a></h3>
<div class="math notranslate nohighlight">
\[(Times-the-word-occurs-in-given-document) \cdot \mbox{log} \frac{(Total-number-of-documents)}{(Number-of-documents-containing-word)}\]</div>
<p>There are variations on the <a class="reference external" href="https://docs.constellate.org/key-terms/#tf-idf">TF-IDF</a> formula, but this is the most widely-used version.</p>
</div>
</div>
<div class="section" id="computing-tf-idf-with-your-dataset">
<h2>Computing TF-IDF with your Dataset<a class="headerlink" href="#computing-tf-idf-with-your-dataset" title="Permalink to this headline">¶</a></h2>
<p>We’ll use the <code class="docutils literal notranslate"><span class="pre">constellate</span></code> client to automatically retrieve the dataset in the JSON file format.</p>
<p>Enter a <a class="reference external" href="https://docs.constellate.org/key-terms/#dataset-ID">dataset ID</a> in the next code cell.</p>
<p>If you don’t have a dataset ID, you can:</p>
<ul class="simple">
<li><p>Use the sample dataset ID already in the code cell</p></li>
<li><p><a class="reference external" href="https://constellate.org/builder">Create a new dataset</a></p></li>
<li><p><a class="reference external" href="https://constellate.org/dataset/dashboard">Use a dataset ID from other pre-built sample datasets</a></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Default dataset is &quot;Shakespeare Quarterly,&quot; 1950-present</span>
<span class="n">dataset_id</span> <span class="o">=</span> <span class="s2">&quot;7e41317e-740f-e86a-4729-20dab492e925&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>Next, import the <code class="docutils literal notranslate"><span class="pre">constellate</span></code> client, passing the <code class="docutils literal notranslate"><span class="pre">dataset_id</span></code> as an argument using the <code class="docutils literal notranslate"><span class="pre">get_dataset</span></code> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importing your dataset with a dataset ID</span>
<span class="kn">import</span> <span class="nn">constellate</span>
<span class="c1"># Pull in the sampled dataset that matches `dataset_id`</span>
<span class="c1"># in the form of a gzipped JSON lines file.</span>
<span class="c1"># The .get_dataset() method downloads the gzipped JSONL file</span>
<span class="c1"># to the /data folder and returns a string for the file name and location</span>
<span class="c1"># dataset_metadata will be a string containing that file name and location</span>
<span class="n">dataset_file</span> <span class="o">=</span> <span class="n">constellate</span><span class="o">.</span><span class="n">get_dataset</span><span class="p">(</span><span class="n">dataset_id</span><span class="p">)</span>

<span class="c1"># To download the full dataset (up to a limit of 25,000 documents),</span>
<span class="c1"># request it first in the builder environment. See the Constellate Client</span>
<span class="c1"># documentation at: https://constellate.org/docs/constellate-client</span>
<span class="c1"># Then use the `constellate.download` method show below.</span>
<span class="c1">#dataset_file = constellate.download(dataset_id, &#39;jsonl&#39;)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="apply-pre-processing-filters-if-available">
<h2>Apply Pre-Processing Filters (if available)<a class="headerlink" href="#apply-pre-processing-filters-if-available" title="Permalink to this headline">¶</a></h2>
<p>If you completed pre-processing with the “Exploring Metadata and Pre-processing” notebook, you can use your CSV file of dataset IDs to automatically filter the dataset. Your pre-processed CSV file  must be in the root folder.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import a pre-processed CSV file of filtered dataset IDs.</span>
<span class="c1"># If you do not have a pre-processed CSV file, the analysis</span>
<span class="c1"># will run on the full dataset and may take longer to complete.</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">pre_processed_file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;data/pre-processed_</span><span class="si">{</span><span class="n">dataset_id</span><span class="si">}</span><span class="s1">.csv&#39;</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pre_processed_file_name</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">pre_processed_file_name</span><span class="p">)</span>
    <span class="n">filtered_id_list</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">use_filtered_list</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pre-Processed CSV found. Successfully read in &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; documents.&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span> 
    <span class="n">use_filtered_list</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No pre-processed CSV file found. Full dataset will be used.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="define-a-unigram-processing-function">
<h2>Define a Unigram Processing Function<a class="headerlink" href="#define-a-unigram-processing-function" title="Permalink to this headline">¶</a></h2>
<p>In this step, we gather the unigrams. If there is a Pre-Processing Filter, we will only analyze documents from the filtered ID list. We will also process each unigram, assessing them individually. We will complete the following tasks:</p>
<ul class="simple">
<li><p>Lowercase all tokens</p></li>
<li><p>Remove tokens in stopwords list</p></li>
<li><p>Remove tokens with fewer than 4 characters</p></li>
<li><p>Remove tokens with non-alphabetic characters</p></li>
</ul>
<p>We can define this process in a function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define a function that will process individual tokens</span>
<span class="c1"># Only a token that passes through all three `if` </span>
<span class="c1"># statements will be returned. A `True` result for</span>
<span class="c1"># any `if` statement does not return the token. </span>

<span class="k">def</span> <span class="nf">process_token</span><span class="p">(</span><span class="n">token</span><span class="p">):</span>
    <span class="n">token</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span> <span class="c1"># If True, do not return token</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()):</span> <span class="c1"># If True, do not return token</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">token</span> <span class="c1"># If all are False, return the lowercased token</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="collect-lists-of-document-ids-titles-and-unigrams">
<h2>Collect lists of Document IDs, Titles, and Unigrams<a class="headerlink" href="#collect-lists-of-document-ids-titles-and-unigrams" title="Permalink to this headline">¶</a></h2>
<p>Next, we process all the unigrams into a list called <code class="docutils literal notranslate"><span class="pre">documents</span></code>. For demonstration purposes, this code runs on a limit of 500 documents, but we can change this to process all the documents. We are also collecting the document titles and ids so we can reference them later.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">documents</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># A list that will contain all of our unigrams</span>
<span class="n">document_ids</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># A list that will contain all of our document ids</span>
<span class="n">document_titles</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># A list that will contain all of our titles</span>

<span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">constellate</span><span class="o">.</span><span class="n">dataset_reader</span><span class="p">(</span><span class="n">dataset_file</span><span class="p">):</span>
    <span class="n">processed_document</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># Temporarily store the unigrams for this document</span>
    <span class="n">document_id</span> <span class="o">=</span> <span class="n">document</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="c1"># Temporarily store the document id for this document</span>
    <span class="n">document_title</span> <span class="o">=</span> <span class="n">document</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="c1"># Temporarily store the document title for this document</span>
    <span class="k">if</span> <span class="n">use_filtered_list</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># Skip documents not in our filtered_id_list</span>
        <span class="k">if</span> <span class="n">document_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">filtered_id_list</span><span class="p">:</span>
            <span class="k">continue</span>
    <span class="n">unigrams</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;unigramCount&quot;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="k">for</span> <span class="n">gram</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">unigrams</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">clean_gram</span> <span class="o">=</span> <span class="n">process_token</span><span class="p">(</span><span class="n">gram</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">clean_gram</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">processed_document</span> <span class="o">+=</span> <span class="p">[</span><span class="n">clean_gram</span><span class="p">]</span> <span class="o">*</span> <span class="n">count</span> <span class="c1"># Add the unigram as many times as it was counted</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">processed_document</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">document_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">document_id</span><span class="p">)</span>
        <span class="n">document_titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">document_title</span><span class="p">)</span>
        <span class="n">documents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">processed_document</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>At this point, we have unigrams collected for all our documents insde the <code class="docutils literal notranslate"><span class="pre">documents</span></code> list variable. Each index of our list is a single document, starting with <code class="docutils literal notranslate"><span class="pre">documents[0]</span></code>. Each document is, in turn, a list with a single stringe for each unigram.</p>
<p><strong>Note:</strong> As we collect the unigrams for each document, we are simply including them in a list of strings. This is not the same as collecting them into word counts, and we are not using a Counter() object here like the Word Frequencies notebook.</p>
<p>The next cell demonstrates the contents of each item in our <code class="docutils literal notranslate"><span class="pre">document</span></code> list. Essentially,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show the unigrams collected for a particular document</span>
<span class="c1"># Change the value of n to see a different document</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>

<span class="nb">print</span><span class="p">(</span><span class="n">document_titles</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
<span class="nb">list</span><span class="p">(</span><span class="n">documents</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>If we wanted to see word frequencies, we could convert the lists at this point into <code class="docutils literal notranslate"><span class="pre">Counter()</span></code> objects. The next cell demonstrates that operation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert a given document into a Counter object to determine</span>
<span class="c1"># word frequencies count</span>

<span class="c1"># Import counter to help count word frequencies</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>

<span class="n">word_freq</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">documents</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># Change documents index to see a different document</span>
<span class="n">word_freq</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<p>Now that we have all the cleaned unigrams for every document in a list called <code class="docutils literal notranslate"><span class="pre">documents</span></code>, we can use Gensim to compute TF/IDF.</p>
</div>
<hr class="docutils" />
<div class="section" id="using-gensim-to-compute-term-frequency-inverse-document-frequency">
<h2>Using Gensim to Compute “Term Frequency- Inverse Document Frequency”<a class="headerlink" href="#using-gensim-to-compute-term-frequency-inverse-document-frequency" title="Permalink to this headline">¶</a></h2>
<p>It will be helpful to remember the basic steps we did in the explanatory <a class="reference external" href="https://docs.constellate.org/key-terms/#tf-idf">TF-IDF</a> example:</p>
<ol class="simple">
<li><p>Create a list of the frequency of every word in every document</p></li>
<li><p>Create a list of every word in the <a class="reference external" href="https://docs.constellate.org/key-terms/#corpus">corpus</a></p></li>
<li><p>Compute <a class="reference external" href="https://docs.constellate.org/key-terms/#tf-idf">TF-IDF</a> based on that data</p></li>
</ol>
<p>So far, we have completed the first item by creating a list of the frequency of every word in every document. Now we need to create a list of every word in the corpus. In <a class="reference external" href="https://docs.constellate.org/key-terms/#gensim">gensim</a>, this is called a “dictionary”. A <a class="reference external" href="https://docs.constellate.org/key-terms/#gensim-dictionary">gensim dictionary</a> is similar to a <a class="reference external" href="https://docs.constellate.org/key-terms/#python-dictionary">Python dictionary</a>, but here it is called a <a class="reference external" href="https://docs.constellate.org/key-terms/#gensim-dictionary">gensim dictionary</a> to show it is a specialized kind of dictionary.</p>
<div class="section" id="creating-a-gensim-dictionary">
<h3>Creating a Gensim Dictionary<a class="headerlink" href="#creating-a-gensim-dictionary" title="Permalink to this headline">¶</a></h3>
<p>Let’s create our <a class="reference external" href="https://docs.constellate.org/key-terms/#gensim-dictionary">gensim dictionary</a>. A <a class="reference external" href="https://docs.constellate.org/key-terms/#gensim-dictionary">gensim dictionary</a> is a kind of masterlist of all the words across all the documents in our corpus. Each unique word is assigned an ID in the gensim dictionary. The result is a set of key/value pairs of unique tokens and their unique IDs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gensim</span>
<span class="n">dictionary</span> <span class="o">=</span> <span class="n">gensim</span><span class="o">.</span><span class="n">corpora</span><span class="o">.</span><span class="n">Dictionary</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <a class="reference external" href="https://docs.constellate.org/key-terms/#gensim-dictionary">gensim dictionary</a> stores a unique identifier (starting with 0) for every unique token in the corpus. The <a class="reference external" href="https://docs.constellate.org/key-terms/#gensim-dictionary">gensim dictionary</a> does not contain information on word frequencies; it only catalogs all the unique words in the corpus. You can see the unique ID for each token in the text using the .token2id() method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">dictionary</span><span class="o">.</span><span class="n">token2id</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>We could also look up the corresponding ID for a token using the <code class="docutils literal notranslate"><span class="pre">.get</span></code> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the value for the key &#39;people&#39;. Return 0 if there is no token matching &#39;people&#39;. </span>
<span class="c1"># The number returned is the gensim dictionary ID for the token. </span>

<span class="n">dictionary</span><span class="o">.</span><span class="n">token2id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;people&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>For the sake of example, we could also discover a particular token using just the ID number. This is not something likely to happen in practice, but it serves here as a demonstration of the connection between tokens and their ID number.</p>
<p>Normally, <a class="reference external" href="https://docs.constellate.org/key-terms/#python-dictionary">Python dictionaries</a> only map from keys to values (not from values to keys). However, we can write a quick for loop to go the other direction. This cell is simply to demonstrate how the <a class="reference external" href="https://docs.constellate.org/key-terms/#gensim-dictionary">gensim dictionary</a> is connected to the list entries in the <a class="reference external" href="https://docs.constellate.org/key-terms/#gensim">gensim</a> <code class="docutils literal notranslate"><span class="pre">bow_corpus</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find the token associated with a token id number</span>
<span class="n">token_id</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1"># If the token id matches, print out the associated token</span>
<span class="k">for</span> <span class="n">dict_id</span><span class="p">,</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">dict_id</span> <span class="o">==</span> <span class="n">token_id</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="creating-a-bag-of-words-corpus">
<h2>Creating a Bag of Words Corpus<a class="headerlink" href="#creating-a-bag-of-words-corpus" title="Permalink to this headline">¶</a></h2>
<p>The next step is to connect our word frequency data found within <code class="docutils literal notranslate"><span class="pre">documents</span></code> to our <a class="reference external" href="https://docs.constellate.org/key-terms/#gensim-dictionary">gensim dictionary</a> token IDs. For every document, we want to know how many times a word (notated by its ID) occurs. We will create a <a class="reference external" href="https://docs.constellate.org/key-terms/#python-list">Python list</a> called <code class="docutils literal notranslate"><span class="pre">bow_corpus</span></code> that will turn our word counts into a series of <a class="reference external" href="https://docs.constellate.org/key-terms/#tuple">tuples</a> where the first number is the <a class="reference external" href="https://docs.constellate.org/key-terms/#gensim-dictionary">gensim dictionary</a> token ID and the second number is the word frequency.</p>
<p><img alt="Combining Gensim dictionary with documents list to create Bag of Words Corpus" src="https://ithaka-labs.s3.amazonaws.com/static-files/images/tdm/tdmdocs/bag-of-words-creation.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a bag of words corpus</span>
<span class="n">bow_corpus</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">:</span>
    <span class="n">bow_corpus</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dictionary</span><span class="o">.</span><span class="n">doc2bow</span><span class="p">(</span><span class="n">document</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Bag of words corpus created successfully.&#39;</span><span class="p">)</span>

<span class="c1"># The for loop could also be written as a list comprehension</span>
<span class="c1"># bow_corpus = [dictionary.doc2bow(document) for document in documents]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Examine the bag of words corpus for a specific document n</span>
<span class="c1"># Change the value of n to see another document</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>

<span class="nb">list</span><span class="p">(</span><span class="n">bow_corpus</span><span class="p">[</span><span class="n">n</span><span class="p">][:</span><span class="mi">25</span><span class="p">])</span> <span class="c1"># List out a slice of the first 25 items</span>
</pre></div>
</div>
</div>
</div>
<p>Using IDs can seem a little abstract, but we can discover the word associated with a particular ID. For demonstration purposes, the following code prints the associated token with the token counts. Each line printed below matches the token id and and count from above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For each id and count in the bag of words corpus</span>
<span class="c1"># Print the corresponding word from the Gensim dictionary and count</span>
<span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">bow_corpus</span><span class="p">[</span><span class="n">n</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">15</span><span class="p">),</span> <span class="n">count</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="create-the-tfidfmodel">
<h2>Create the <code class="docutils literal notranslate"><span class="pre">TfidfModel</span></code><a class="headerlink" href="#create-the-tfidfmodel" title="Permalink to this headline">¶</a></h2>
<p>The next step is to create the <a class="reference external" href="https://docs.constellate.org/key-terms/#tf-idf">TF-IDF</a> model which will set the parameters for our implementation of <a class="reference external" href="https://docs.constellate.org/key-terms/#tf-idf">TF-IDF</a>. In our <a class="reference external" href="https://docs.constellate.org/key-terms/#tf-idf">TF-IDF</a> example, the formula for <a class="reference external" href="https://docs.constellate.org/key-terms/#tf-idf">TF-IDF</a> was:</p>
<div class="math notranslate nohighlight">
\[(Times-the-word-occurs-in-given-document) \cdot \mbox{log} \frac{(Total-number-of-documents)}{(Number-of-documents-containing-word)}\]</div>
<p>In <a class="reference external" href="https://docs.constellate.org/key-terms/#gensim">gensim</a>, the default formula for measuring <a class="reference external" href="https://docs.constellate.org/key-terms/#tf-idf">TF-IDF</a> uses log base 2 instead of log base 10, as shown:</p>
<div class="math notranslate nohighlight">
\[(Times-the-word-occurs-in-given-document) \cdot \log_{2} \frac{(Total-number-of-documents)}{(Number-of-documents-containing-the-word)}\]</div>
<p>If you would like to use a different formula for your <a class="reference external" href="https://docs.constellate.org/key-terms/#tf-idf">TF-IDF</a> calculation, there is a description of <a class="reference external" href="https://radimrehurek.com/gensim/models/tfidfmodel.html">parameters you can pass</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create our gensim TF-IDF model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">gensim</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">TfidfModel</span><span class="p">(</span><span class="n">bow_corpus</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<p>Now, we apply our model to the <code class="docutils literal notranslate"><span class="pre">bow_corpus</span></code> to create our results in <code class="docutils literal notranslate"><span class="pre">corpus_tfidf</span></code>. The <code class="docutils literal notranslate"><span class="pre">corpus_tfidf</span></code> is a python list of each document similar to <code class="docutils literal notranslate"><span class="pre">bow_document</span></code>. Instead of listing the frequency next to the <a class="reference external" href="https://docs.constellate.org/key-terms/#gensim-dictionary">gensim dictionary</a> ID, however, it contains the <a class="reference external" href="https://docs.constellate.org/key-terms/#tf-idf">TF-IDF</a> score for the associated token. Below, we display the first document in <code class="docutils literal notranslate"><span class="pre">corpus_tfidf</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create TF-IDF scores for the ``bow_corpus`` using our model</span>
<span class="n">corpus_tfidf</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="n">bow_corpus</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># List out the TF-IDF scores for the nth document&#39;s first 10 tokens</span>
<span class="c1"># Change n to change the document</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>

<span class="nb">list</span><span class="p">(</span><span class="n">corpus_tfidf</span><span class="p">[</span><span class="n">n</span><span class="p">][:</span><span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s display the tokens instead of the <a class="reference external" href="https://docs.constellate.org/key-terms/#gensim-dictionary">gensim dictionary</a> IDs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">corpus_tfidf</span><span class="p">[</span><span class="n">n</span><span class="p">][:</span><span class="mi">10</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">score</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="find-top-terms-in-a-single-document">
<h2>Find Top Terms in a Single Document<a class="headerlink" href="#find-top-terms-in-a-single-document" title="Permalink to this headline">¶</a></h2>
<p>Finally, let’s sort the terms by their <a class="reference external" href="https://docs.constellate.org/key-terms/#tf-idf">TF-IDF</a> weights to find the most significant terms in the document.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sort the tuples in our tf-idf scores list</span>

<span class="c1"># Choosing a document by its index number</span>
<span class="c1"># Change n to see a different document</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">Sort</span><span class="p">(</span><span class="n">tfidf_tuples</span><span class="p">):</span>
    <span class="s2">&quot;This sorts based on the second value in our tuple, the tf-idf score&quot;</span>
    <span class="n">tfidf_tuples</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tfidf_tuples</span> 

<span class="c1"># Print the document id and title</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Title: &#39;</span><span class="p">,</span> <span class="n">document_titles</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ID: &#39;</span><span class="p">,</span> <span class="n">document_ids</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----------------------------------------&#39;</span><span class="p">)</span>

<span class="c1"># List the top twenty tokens in our example document by their TF-IDF scores</span>
<span class="c1"># First we sort the tokens with their scores</span>
<span class="n">most_significant_terms</span> <span class="o">=</span> <span class="n">Sort</span><span class="p">(</span><span class="n">corpus_tfidf</span><span class="p">[</span><span class="n">n</span><span class="p">])[:</span><span class="mi">20</span><span class="p">]</span>

<span class="c1"># Next we print the list, replacing the token ids with the tokens</span>
<span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">most_significant_terms</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">score</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We could also analyze across the entire corpus to find the most unique terms. These are terms that appear in a particular text, but rarely or never appear in other texts. (Often, these will be proper names since a particular article may mention a name often but the name may rarely appear in other articles. There’s also a fairly good chance these will be typos or errors in optical character recognition.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">td</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">corpus_tfidf</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">token_id</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">document</span><span class="p">:</span>
        <span class="n">current_score</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dictionary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">token_id</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">current_score</span> <span class="o">&lt;</span> <span class="n">score</span><span class="p">:</span>
            <span class="n">td</span><span class="o">.</span><span class="n">update</span><span class="p">([(</span><span class="n">dictionary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">token_id</span><span class="p">),</span> <span class="n">score</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sort the items of ``td`` into a new variable ``sorted_td``</span>
<span class="c1"># the ``reverse`` starts from highest to lowest</span>
<span class="n">sorted_td</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">kv</span><span class="p">:</span> <span class="n">kv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 

<span class="k">for</span> <span class="n">term</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">sorted_td</span><span class="p">[:</span><span class="mi">25</span><span class="p">]:</span> <span class="c1"># Print the top 25 terms in the entire corpus</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">weight</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="display-most-significant-term-for-each-document">
<h2>Display Most Significant Term for each Document<a class="headerlink" href="#display-most-significant-term-for-each-document" title="Permalink to this headline">¶</a></h2>
<p>We can see the most significant term in every document.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For each document, print the ID, most significant/unique word, and TF/IDF score</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">corpus_tfidf</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">word_id</span><span class="p">,</span> <span class="n">score</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">document_ids</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">word_id</span><span class="p">),</span> <span class="n">score</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
        <span class="k">break</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="ranking-documents-by-tf-idf-score-for-a-search-word">
<h2>Ranking documents by TF-IDF Score for a Search Word<a class="headerlink" href="#ranking-documents-by-tf-idf-score-for-a-search-word" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set a limit on the number of documents analyzed</span>
<span class="n">limit</span> <span class="o">=</span> <span class="mi">500</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="n">terms_to_docs</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<span class="k">for</span> <span class="n">doc_id</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">corpus_tfidf</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">term_id</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
        <span class="n">term</span> <span class="o">=</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">term_id</span><span class="p">)</span>
        <span class="n">terms_to_docs</span><span class="p">[</span><span class="n">term</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">doc_id</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">doc_id</span> <span class="o">&gt;=</span> <span class="n">limit</span><span class="p">:</span>
        <span class="k">break</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pick a unigram to discover its score across documents</span>
<span class="n">search_term</span> <span class="o">=</span> <span class="s1">&#39;coriolanus&#39;</span>

<span class="c1"># Display a list of documents and scores for the search term</span>

<span class="n">matching</span> <span class="o">=</span> <span class="n">terms_to_docs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">search_term</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span> 
    <span class="k">for</span> <span class="n">doc_id</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">matching</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">document_ids</span><span class="p">[</span><span class="n">doc_id</span><span class="p">],</span> <span class="n">score</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Search term not found. Change the term or expand the corpus size.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Nathan Kelber and Ted Lawless<br/>
        
          <div class="extra_footer">
            <div>
<a href="https://creativecommons.org/licenses/by/2.0/"><img class="license" alt="Creative Commons License" src="https://ithaka-labs.s3.amazonaws.com/static-files/images/tdm/tdmdocs/CC_BY.png" /></a> The tutorials and workshop materials are licensed under a <a href="https://creativecommons.org/licenses/by/2.0/">Creative Commons BY License</a>.
</div>

          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-125778965-3', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </body>
</html>